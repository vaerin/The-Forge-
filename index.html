<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Forge Calculator</title>
    <style>
      body {
        font-family: Arial;
        background: url("https://static.wikitide.net/theforgewiki/d/dd/Bgwiki.png")
          no-repeat center center fixed;
        background-size: cover;
        margin: 0px;
        color: #f7f7f7;
      }
      .overlay {
        background-color: rgba(34, 21, 19, 0.7);
        min-height: 100vh;
        padding: 0px, 0px, 20px;
      }
      .content-wrapper {
        max-width: 1000px;
        min-height: 100vh;
        margin: auto;
        background-color: rgba(34, 21, 19, 0.8);
        backdrop-filter: grayscale(0.3) blur(5px);
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      .ore-input-row {
        display: flex;
        margin-bottom: 10px;
      }
      .input-wrapper {
        position: relative;
        flex: 1;
        margin-right: 10px;
      }
      .ore-search {
        width: 90%;
        padding: 5px;
      }
      .clear-btn {
        display: none;
      }

      .ore-options {
        transition: opacity 0.15s ease;
        opacity: 0;
        display: none;
        list-style: none;
        margin: 0;
        padding: 0;
        border: 1px solid #ccc;
        max-height: 120px;
        overflow: auto;
        display: none;
        position: absolute;
        background: #2f2921; /* dark dropdown */
        color: #f7f7f7;
        width: 92%;
        z-index: 10;
      }

      .ore-options li {
        padding: 5px;
        cursor: pointer;
      }
      .ore-options.show {
        display: block;
        opacity: 1;
      }
      .ore-options li:hover {
        background: #3a3221;
      }
      button {
        padding: 10px 20px;
        margin-top: 10px;
      }
      #result {
        white-space: pre-line;
        margin-top: 20px;
        background: #f9f9f9;
        padding: 10px;
        border-radius: 5px;
        color: #101010;
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="overlay">
      <div class="content-wrapper">
        <h1>Forge Calculator</h1>

        <!-- Craft type -->
        <label for="craft_type">Type:</label>
        <select id="craft_type">
          <option value="Weapon">Weapon</option>
          <option value="Armor">Armor</option>
        </select>

        <br /><br />

        <!-- Weapon selection -->
        <div id="weaponSelectDiv">
          <label for="weaponSelect">Select Weapon:</label>
          <select id="weaponSelect"></select>
        </div>

        <!-- Armor selection -->
        <div id="armorSelectDiv" style="display: none">
          <label for="armorSelect">Select Armor:</label>
          <select id="armorSelect">
            <option value="">-- Select Armor --</option>
          </select>
        </div>

        <br />

        <!-- Ore inputs -->
        <div id="oreInputs">
          <div class="ore-input-row">
            <div class="input-wrapper">
              <input
                type="text"
                id="name1"
                class="ore-search"
                placeholder="Select Ore #1"
              />
              <button class="clear-btn" data-target="name1">×</button>
              <ul class="ore-options" id="options1"></ul>
            </div>
            <input type="number" id="amt1" placeholder="Amount #1" />
          </div>
          <div class="ore-input-row">
            <div class="input-wrapper">
              <input
                type="text"
                id="name2"
                class="ore-search"
                placeholder="Select Ore #2"
              />
              <button class="clear-btn" data-target="name2">×</button>
              <ul class="ore-options" id="options2"></ul>
            </div>
            <input type="number" id="amt2" placeholder="Amount #2" />
          </div>
          <div class="ore-input-row">
            <div class="input-wrapper">
              <input
                type="text"
                id="name3"
                class="ore-search"
                placeholder="Select Ore #3"
              />
              <button class="clear-btn" data-target="name3">×</button>
              <ul class="ore-options" id="options3"></ul>
            </div>
            <input type="number" id="amt3" placeholder="Amount #3" />
          </div>
          <div class="ore-input-row">
            <div class="input-wrapper">
              <input
                type="text"
                id="name4"
                class="ore-search"
                placeholder="Select Ore #4"
              />
              <button class="clear-btn" data-target="name4">×</button>
              <ul class="ore-options" id="options4"></ul>
            </div>
            <input type="number" id="amt4" placeholder="Amount #4" />
          </div>
        </div>

        <button id="calculateBtn">Calculate</button>
        <div id="result"></div>
      </div>
    </div>
    <script>
      const ores = {
        "Stone Ore": { multiplier: 0.2, traitType: null, traits: [] },
        "Sand Stone": { multiplier: 0.25, traitType: null, traits: [] },
        "Copper Ore": { multiplier: 0.3, traitType: null, traits: [] },
        "Iron Ore": { multiplier: 0.35, traitType: null, traits: [] },
        "Tin Ore": { multiplier: 0.425, traitType: null, traits: [] },
        "Silver Ore": { multiplier: 0.5, traitType: null, traits: [] },
        "Gold Ore": { multiplier: 0.65, traitType: null, traits: [] },
        "Mushroomite Ore": { multiplier: 0.8, traitType: null, traits: [] },
        "Platinum Ore": { multiplier: 0.8, traitType: null, traits: [] },
        "Bananite Ore": { multiplier: 0.85, traitType: null, traits: [] },
        "Cardboardite Ore": { multiplier: 0.7, traitType: null, traits: [] },
        "Aite Ore": { multiplier: 1.0, traitType: null, traits: [] },
        "Poopite Ore": { multiplier: 1.2, traitType: null, traits: [] },
        "Cobalt Ore": { multiplier: 1.0, traitType: null, traits: [] },
        "Titanium Ore": { multiplier: 1.15, traitType: null, traits: [] },
        "Lapis Lazuli Ore": { multiplier: 1.3, traitType: null, traits: [] },
        "Volcanic Rock": { multiplier: 1.55, traitType: null, traits: [] },
        "Quartz Ore": { multiplier: 1.5, traitType: null, traits: [] },
        "Amethyst Ore": { multiplier: 1.65, traitType: null, traits: [] },
        "Topaz Ore": { multiplier: 1.75, traitType: null, traits: [] },
        "Diamond Ore": { multiplier: 2.0, traitType: null, traits: [] },
        "Sapphire Ore": { multiplier: 2.25, traitType: null, traits: [] },
        "Cuprite Ore": { multiplier: 2.43, traitType: null, traits: [] },
        "Obsidian Ore": {
          multiplier: 2.35,
          traitType: "Armor",
          traits: [{ description: "Vitality", maxStat: 30, type: "Armor" }],
        },
        "Emerald Ore": { multiplier: 2.55, traitType: null, traits: [] },
        "Ruby Ore": { multiplier: 2.95, traitType: null, traits: [] },
        "Rivalite Ore": {
          multiplier: 3.33,
          traitType: "Weapon",
          traits: [
            {
              description: "Crit Chance on Weapons",
              maxStat: 20,
              type: "Weapon",
            },
          ],
        },
        "Uranium Ore": {
          multiplier: 3.0,
          traitType: "Armor",
          traits: [
            {
              description: "max HP AOE Damage on Armor",
              maxStat: 5,
              type: "Armor",
            },
          ],
        },
        "Mythril Ore": {
          multiplier: 3.5,
          traitType: "Armor",
          traits: [{ description: "Vitality", maxStat: 15, type: "Armor" }],
        },
        "Eye Ore": {
          multiplier: 4.0,
          traitType: "All",
          traits: [
            { description: "Weapon Damage", maxStat: 15 },
            { description: "Health", maxStat: -10 },
          ],
        },
        "Fireite Ore": {
          multiplier: 4.5,
          traitType: "Weapon",
          traits: [
            { description: "Burn Damage on Weapons with", maxStat: 20 },
            { description: "chance", maxStat: 30 },
          ],
        },
        "Magmaite Ore": {
          multiplier: 5.0,
          traitType: "Weapon",
          traits: [
            { description: "AOE Explosion on Weapons with", maxStat: 50 },
            { description: "chance", maxStat: 35 },
          ],
        },
        "Lightite Ore": {
          multiplier: 4.6,
          traitType: "Armor",
          traits: [
            { description: "Bonus Movement Speed", maxStat: 15, type: "Armor" },
          ],
        },
        "Demonite Ore": {
          multiplier: 5.5,
          traitType: "Armor",
          traits: [
            {
              description: "to Burn Enemy when Damage is Taken.",
              maxStat: 25,
              type: "Armor",
            },
          ],
        },
        "Darkryte Ore": {
          multiplier: 6.3,
          traitType: "Armor",
          traits: [
            {
              description: "Chance to Dodge Damage (Negate Fully)",
              maxStat: 15,
              type: "Armor",
            },
          ],
        },
        "Magenta Crystal Ore": { multiplier: 3.1, traitType: null, traits: [] },
        "Crimson Crystal Ore": { multiplier: 3.3, traitType: null, traits: [] },
        "Green Crystal Ore": { multiplier: 3.2, traitType: null, traits: [] },
        "Orange Crystal Ore": { multiplier: 3.0, traitType: null, traits: [] },
        "Blue Crystal Ore": { multiplier: 3.4, traitType: null, traits: [] },
        "Rainbow Crystal Ore": {
          multiplier: 5.25,
          traitType: null,
          traits: [],
        },
        "Arcane Crystal Ore": { multiplier: 7.5, traitType: null, traits: [] },
        "Galaxite Ore": { multiplier: 11.5, traitType: null, traits: [] },
        "Vooite Ore": { multiplier: 0.0, traitType: null, traits: [] },
      };

      const weapons = {
        Dagger: {
          Dagger: { BaseShown: 4.3, RealBase: 8.6 },
          "Falchion Knife": { BaseShown: 4.3, RealBase: 8.6 },
          Gladius: { BaseShown: 4.3, RealBase: 8.6 },
        },
        "Straight Sword": {
          Falchion: { BaseShown: 7.5, RealBase: 15 },
          Cutlass: { BaseShown: 9.375, RealBase: 18.75 },
          Rapier: { BaseShown: 7.5, RealBase: 15 },
          Chaos: { BaseShown: 9.375, RealBase: 18.75 },
        },
        Gauntlet: {
          Gauntlet: { BaseShown: 7.6, RealBase: 15.2 },
          Relevator: { BaseShown: 9.6, RealBase: 19.2 },
        },
        Katana: {
          Uchigatana: { BaseShown: 8.5, RealBase: 17 },
          Tachi: { BaseShown: 8.925, RealBase: 17.85 },
        },
        "Great Sword": {
          "Crusader Sword": { BaseShown: 12, RealBase: 24 },
          "Long Sword": { BaseShown: 12, RealBase: 24 },
        },
        "Great Axe": {
          Scythe: { BaseShown: 14.25, RealBase: 28.5 },
          "Double Battle Axe": { BaseShown: 15.75, RealBase: 31.5 },
        },
        "Colossal Sword": {
          "Great Sword": { BaseShown: 20, RealBase: 40 },
          "Dragon Slayer": { BaseShown: 22, RealBase: 44 },
          Hammer: { BaseShown: 22, RealBase: 44 },
          "Skull Crusher": { BaseShown: 24, RealBase: 48 },
        },
      };

      const weaponCooldowns = {
        Dagger: 0.35,
        "Falchion Knife": 0.35,
        Gladius:0.35,
        Cutlass: 0.66,
        Rapier: 0.49,
        Falchion: 0.59,
        Gauntlet: 0.51,
        Uchigatana: 0.6,
        "Crusader Sword": 1.0,
        "Long Sword": 1.11,
        Scythe: 0.95,
        "Double Battle Axe": 1.05,
        "Great Sword": 1.12,
        "Dragon Slayer": 1.12,
        Hammer: 1.24,
        "Skull Crusher": 1.4,
        Chaos: 0.59,
        Relevator: 0.69,
        Tachi: 0.63,
      };

      const armors = {
        "Heavy Chestplate": {
          "Knight Chestplate": { BaseShown: 16.25, RealBase: 32.5 },
          "Dark Knight Chestplate": { BaseShown: 25, RealBase: 50 },
        },
        "Heavy Leggings": {
          "Knight Leggings": { BaseShown: 13.75, RealBase: 27.5 },
          "Dark Knight Leggings": { BaseShown: 21.875, RealBase: 43.75 },
        },
        "Heavy Helmet": {
          "Knight Helmet": { BaseShown: 12.5, RealBase: 25 },
          "Dark Knight Helmet": { BaseShown: 18.75, RealBase: 37.5 },
        },
      };

      const weaponSelect = document.getElementById("weaponSelect");
      for (const type in weapons) {
        for (const w in weapons[type]) {
          let opt = document.createElement("option");
          opt.value = `${type}||${w}`;
          opt.textContent = `${w} (${type}) - Base: ${weapons[type][w].BaseShown}`;
          weaponSelect.appendChild(opt);
        }
      }

      const armorSelect = document.getElementById("armorSelect");
      for (const type in armors) {
        for (const name in armors[type]) {
          let opt = document.createElement("option");
          opt.value = `${type}||${name}`;
          opt.textContent = `${name} (${type}) - Base: ${armors[type][name].BaseShown}`;
          armorSelect.appendChild(opt);
        }
      }

      document.getElementById("craft_type").addEventListener("change", (e) => {
        if (e.target.value === "Armor") {
          document.getElementById("armorSelectDiv").style.display = "block";
          document.getElementById("weaponSelectDiv").style.display = "none";
        } else {
          document.getElementById("armorSelectDiv").style.display = "none";
          document.getElementById("weaponSelectDiv").style.display = "block";
        }
      });

      document.querySelectorAll(".ore-search").forEach((input, idx) => {
        const list = document.getElementById(`options${idx + 1}`);
        const wrapper = input.parentElement;
        const clearBtn = wrapper.querySelector(".clear-btn");

        for (const oreName in ores) {
          const li = document.createElement("li");
          li.textContent = oreName;

          li.addEventListener("mousedown", (e) => {
            e.preventDefault();
            input.value = oreName;
            hideList();
          });

          list.appendChild(li);
        }

        input.addEventListener("input", () => {
          const val = input.value.toLowerCase();

          let visible = false;
          list.querySelectorAll("li").forEach((li) => {
            if (li.textContent.toLowerCase().startsWith(val)) {
              li.style.display = "";
              visible = true;
            } else {
              li.style.display = "none";
            }
          });

          if (val === "") visible = false;

          if (visible) showList();
          else hideList();
        });

        list.addEventListener("mouseenter", () => showList());
        list.addEventListener("mouseleave", () => hideListIfNoInput());

        clearBtn.addEventListener("mousedown", (e) => e.preventDefault());
        clearBtn.addEventListener("click", () => {
          input.value = "";
          hideList();
        });

        document.addEventListener("click", (e) => {
          if (!wrapper.contains(e.target)) hideList();
        });

        function showList() {
          list.classList.add("show");
        }
        function hideList() {
          list.classList.remove("show");
        }
        function hideListIfNoInput() {
          if (input.value.trim() === "") hideList();
        }
      });

      document.querySelectorAll(".clear-btn").forEach((btn) => {
        const input = document.getElementById(btn.dataset.target);
        btn.addEventListener("click", () => {
          input.value = "";
          btn.style.display = "none";
        });
      });

      // Get selected ores
      function getSelectedOres() {
        const sel = {};
        for (let i = 1; i <= 4; i++) {
          const name = document.getElementById(`name${i}`).value.trim();
          const amt = parseFloat(document.getElementById(`amt${i}`).value);
          if (name && amt > 0) sel[name] = amt;
        }
        return sel;
      }

      // Calculate combined multiplier
      function calculateCombinedMultiplier(selectedOres) {
        let total = 0,
          sum = 0;
        for (const [ore, amt] of Object.entries(selectedOres)) {
          total += ores[ore].multiplier * amt;
          sum += amt;
        }
        return sum === 0 ? 0 : total / sum;
      }

      // Calculate traits
      function getTraits(selectedOres, craftType) {
        const traits = [];
        const total = Object.values(selectedOres).reduce((a, b) => a + b, 0);
        const topAmount = Math.max(...Object.values(selectedOres));

        for (const oreName of Object.keys(selectedOres)) {
          const ore = ores[oreName];
          const amount = selectedOres[oreName];

          if (!ore?.traits?.length) continue;

          if (
            ore.traitType &&
            ore.traitType !== craftType &&
            ore.traitType !== "All"
          )
            continue;

          const ratioTotal = amount / total;

          let multiplier = 0;

          // 1) Less than 10% → no effect
          if (ratioTotal < 0.1) {
            multiplier = 0;
          }
          // 2) Equal to top ore → 100%
          else if (amount === topAmount) {
            multiplier = 1;
          }
          // 3) Otherwise: (amount / topAmount)
          else {
            multiplier = amount / topAmount;
          }

          ore.traits.forEach((t) => {
            const value = (multiplier * t.maxStat).toFixed(2);
            traits.push(`${value}% ${t.description}`);
          });
        }

        return traits.length ? traits : ["No traits"];
      }

      // Main calculation
      document.getElementById("calculateBtn").addEventListener("click", () => {
        const resultDiv = document.getElementById("result");
        const craftType = document.getElementById("craft_type").value;
        const selectedOres = getSelectedOres();

        if (Object.keys(selectedOres).length === 0) {
          resultDiv.innerText = "Select at least 1 ore";
          resultDiv.style.display = "block"; // show it
          return;
        }

        const combined = calculateCombinedMultiplier(selectedOres);
        const traits = getTraits(selectedOres, craftType);

        let output = "";

        if (craftType === "Weapon") {
          const [type, name] = weaponSelect.value.split("||");
          const base = weapons[type][name];
          const realBase = base.RealBase;
          const finalDamage = realBase * combined;
          const cooldown = weaponCooldowns[name] || 1;
          const dps = finalDamage / cooldown;
          output += `Weapon: ${name} (${type})
Real Base Damage: ${realBase}
Combined Multiplier: ${combined.toFixed(2)}
Final Damage: ${finalDamage.toFixed(2)}
DPS: ${dps.toFixed(2)}
Traits:
  ${traits.join("\n  ")}`;
        } else {
          const [type, name] = armorSelect.value.split("||");
          if (!name) {
            resultDiv.innerText = "Select an armor";
            resultDiv.style.display = "block";
            return;
          }
          const realBase = armors[type][name].RealBase;
          const finalDef = realBase * combined;
          output += `Armor: ${name} (${type})
Base DEF: ${realBase}
Combined Multiplier: ${combined.toFixed(2)}
Final Armor DEF: ${finalDef.toFixed(2)}
Traits:
  ${traits.join("\n  ")}`;
        }

        resultDiv.innerText = output;
        resultDiv.style.display = "block";
      });
    </script>
  </body>
</html>


